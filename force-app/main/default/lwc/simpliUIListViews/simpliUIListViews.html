<!-- sldsValidatorIgnore -->
<!--
  @description       : The main LWC for displaying the list views.
  @author            : tom@ansleyllc.com
  @group             : 
  @last modified on  : 03-23-2025
  @last modified by  : tom@ansleyllc.com
  Modifications Log 
  Ver   Date         Author              Modification
  1.0   08-03-2020   tom@ansleyllc.com   Initial Version
  2.0   07-28-2021   tom@ansleyllc.com   Changed all strings to labels.
  3.0   10-08-2021   tom@ansleyllc.com   Added popover functionality.

-->
<template>
    <div class={mainwrapperstyle}>
        <template if:true={spinner}>
             <c-simpli-u-i-list-views-spinner text={label.Loading}></c-simpli-u-i-list-views-spinner>
        </template>

        <!-- ------------------------------------------------------------------------ -->
        <!-- Section which handles the initialization of the list views if its needed -->
        <!-- ------------------------------------------------------------------------ -->
        <c-simpli-u-i-list-views-init-card batch-id={batchId}
                                           oninitializedcheck={handleInitializedCheck}>
        </c-simpli-u-i-list-views-init-card>

        <!-- ---------------------------------------------------------------------------------- -->
        <!-- Section which holds all picklist and buttons for list view functionality           -->
        <!-- ---------------------------------------------------------------------------------- -->
        <template if:true={isInitialized}>
            <div class="header">
                <template if:true={hasTitle}>
                    <template if:true={isModeApp}>
                        <div slot="title" class="title">
                            {mainTitle}
                        </div>
                    </template>
                </template>
                
                <lightning-layout multiple-rows={headerCanWrap} class="slds-wrap">

                    <template if:true={hasTitle}>
                        <template if:false={isModeApp}>
                            <lightning-layout-item>
                                <h2 class="title">
                                    {mainTitle}
                                </h2>
                            </lightning-layout-item>
                        </template>
                    </template>

                    <!-- --------------------- -->
                    <!-- OBJECT PICKLIST       -->
                    <!-- --------------------- -->
                    <template if:true={displayObjectNames}>
                        <lightning-layout-item class={objectlistdropdownstyle}>
                            <template if:true={typeAheadObjectSearch}>
                                <c-simpli-u-i-list-views-type-ahead search-type="schema" 
                                                                    label-field-name="Label"
                                                                    key-field-name="Name"
                                                                    initial-id={selectedObject}
                                                                    field-obj-name="SObject"
                                                                    where-clause={whereClauseObject}
                                                                    onvaluechange={handleObjectChange}>
                                </c-simpli-u-i-list-views-type-ahead>
                            </template>
                            <template if:false={typeAheadObjectSearch}>
                                <lightning-combobox placeholder={label.Select_Object} 
                                                    label={label.Object} 
                                                    value={selectedObject} 
                                                    onchange={handleObjectChange} 
                                                    options={objectList}
                                                    variant=label-hidden
                                                    dropdown-alignment="auto">
                                </lightning-combobox>                        
                            </template>
                        </lightning-layout-item>
                    </template>

                    <!-- --------------------- -->
                    <!-- LIST VIEW PICKLIST    -->
                    <!-- --------------------- -->
                    <template if:true={displayListViewNames}>
                        <template if:true={selectedObject}>
                            <lightning-layout-item class={listviewdropdownstyle} style="padding-left:5px;">
                                <template if:true={typeAheadListSearch}>
                                    <c-simpli-u-i-list-views-type-ahead search-type="sobject"
                                                                        label-field-name="simpli_lv__Label__c"
                                                                        key-field-name="simpli_lv__API_Name__c"
                                                                        initial-id={selectedListViewId}
                                                                        field-obj-name="simpli_lv__List_View__c"
                                                                        where-clause={whereClauseListView}
                                                                        onvaluechange={handleListViewChanged}>
                                    </c-simpli-u-i-list-views-type-ahead>
                                </template>
                                <template if:false={typeAheadListSearch}>
                                    <lightning-combobox placeholder={label.Select_List_View} 
                                                        label={label.List_View} 
                                                        value={selectedListView} 
                                                        onchange={handleListViewChanged} 
                                                        options={listViewList}
                                                        variant=label-hidden
                                                        title={modifiedText}
                                                        dropdown-alignment="auto">
                                    </lightning-combobox>
                                </template>
                            </lightning-layout-item>
                        </template>
                    </template>

                    <!-- --------------------- -->
                    <!-- DATA SPINNER          -->
                    <!-- --------------------- -->
                    <lightning-layout-item>
                        <div style="font-size: 1.1rem;">
                            <template if:true={dataSpinner}>
                                <div class="dataSpinnerHolder">
                                    <lightning-spinner alternative-text={label.Loading} size="x-small"></lightning-spinner>
                                </div>
                            </template>
                        </div>
                    </lightning-layout-item>

                    <!-- ------------------------- -->
                    <!-- ORIGINAL LIST VIEW BUTTON -->
                    <!-- ------------------------- -->
                    <template if:true={displayURL}>
                        <template if:true={listViewData}>
                            <template if:true={listViewData.isCoreListView}>
                                <lightning-layout-item style="padding-left:5px;">
                                    <a href={listViewData.coreListViewURL} target="_blank">
                                        <lightning-button-icon title={label.Go_To_Original} 
                                                                size="medium" 
                                                                icon-name="utility:picklist_choice">
                                        </lightning-button-icon></a>
                                </lightning-layout-item>
                            </template>
                        </template>
                    </template>

                    <!-- ------------------------- -->
                    <!-- REFRESH BUTTON            -->
                    <!-- ------------------------- -->
                    <template if:true={canReprocess}>
                        <lightning-layout-item style="padding-left:5px;">
                            <lightning-button-icon title={refreshTitle} 
                                                size="medium" 
                                                icon-name="action:new_task" 
                                                onclick={handleProcessListViewsButtonClick}>
                            </lightning-button-icon>
                        </lightning-layout-item>
                    </template>

                    <!-- ------------------------- -->
                    <!-- PIN/UNPIN BUTTON          -->
                    <!-- ------------------------- -->
                    <template if:true={canPin}>
                        <template if:true={listViewData}>
                            <lightning-layout-item style="padding-left:5px;">
                                <template if:false={isPinned}>
                                    <lightning-button-icon title={label.Pin_List_View}
                                                            size="medium" 
                                                            icon-name="utility:pin" 
                                                            onclick={handlePinningClick}>
                                    </lightning-button-icon>
                                </template>
                                <template if:true={isPinned}>
                                    <lightning-button-icon title={label.Unpin_List_View} 
                                                            size="medium" 
                                                            icon-name="utility:pinned" 
                                                            onclick={handleUnpinningClick}>
                                    </lightning-button-icon>
                                </template>
                            </lightning-layout-item>
                        </template>
                    </template>
                    
                    <!-- ------------------------- -->
                    <!-- ROW COUNT AND EXPORT LINK -->
                    <!-- ------------------------- -->
                    <template if:true={displayRowCount}>
                        <template if:true={listViewData}>
                            <template if:true={displayExportButton}>
                                <lightning-layout-item title={label.Export_All} style="height:32px; padding-left:10px; display: flex; justify-content: center; align-items: center;">
                                    {label.Rows}:&nbsp;<a onclick={handleDownloadData}>{listViewDisplayedRowsSize}</a>
                                </lightning-layout-item>
                            </template>
                            <template if:false={displayExportButton}>
                                <lightning-layout-item style="height:32px; padding-left:10px; display: flex; justify-content: center; align-items: center;">
                                    {label.Rows}: {listViewDisplayedRowsSize}
                                </lightning-layout-item>
                            </template>
                        </template>
                    </template>

                    <!-- --------------------------- -->
                    <!-- ROW SELECT COUNT AND EXPORT -->
                    <!-- --------------------------- -->
                    <template if:true={displaySelectedCount}>
                        <template if:true={listViewData}>
                            <template if:true={displayExportButton}>
                                <lightning-layout-item title={label.Export_Selected} style="height:32px; padding-left:10px; display: flex; justify-content: center; align-items: center;">
                                    {label.Selected}:&nbsp;<a onclick={handleSelectedDownloadData}>{selectedRecordCount}</a>
                                </lightning-layout-item>
                            </template>
                            <template if:false={displayExportButton}>
                                <lightning-layout-item style="height:32px; padding-left:10px; display: flex; justify-content: center; align-items: center;">
                                    {label.Selected}: {selectedRecordCount}
                                </lightning-layout-item>
                            </template>
                        </template>
                    </template>

                    <lightning-layout-item alignment-bump="left">
                        <lightning-layout>

                            <!-- ------------------------- -->
                            <!-- SEARCH TEXTFIELD          -->
                            <!-- ------------------------- -->
                            <template if:true={displayTextSearch}>
                                <template if:true={listViewData}>
                                    <lightning-layout-item style="padding-left:5px;">
                                        <lightning-input placeholder={label.Search_List_Dot}
                                                            type="text"
                                                            value={textSearchText}
                                                            variant=label-hidden
                                                            onchange={handleTextSearchChange}
                                                            onkeypress={handleTextSearch}>
                                        </lightning-input>
                                    </lightning-layout-item>
                                </template>
                            </template>

                            <!-- ------------------------- -->
                            <!-- ACTION COMBOBOX           -->
                            <!-- ------------------------- -->
                            <template if:true={canDisplayActions}>
                                <template if:true={listViewData}>
                                    <lightning-layout-item style="padding-left:5px;">
                                        <lightning-combobox name="Action List"
                                                            placeholder={label.Select_Action}
                                                            value={label.Select_Action}
                                                            onchange={handleActionSelect} 
                                                            options={displayedActionList}
                                                            variant=label-hidden
                                                            dropdown-alignment="auto">
                                        </lightning-combobox>
                                    </lightning-layout-item>
                                </template>
                            </template>

                            <!-- ------------------------- -->
                            <!-- AUTO REFRESH BUTTON       -->
                            <!-- ------------------------- -->
                            <template if:true={listViewData}>
                                <template if:true={allowRefresh}>
                                    <lightning-layout-item style="padding-left:5px;">
                                        <template if:true={isRefreshing}>
                                            <lightning-button-icon title={label.Stop_Auto_Refresh} 
                                                                    size="medium" 
                                                                    icon-name="utility:rotate" 
                                                                    onclick={handleAutoRefreshButtonClick}>
                                            </lightning-button-icon>
                                        </template>
                                        <template if:false={isRefreshing}>
                                            <lightning-button-icon title={label.Refresh} 
                                                                    size="medium" 
                                                                    icon-name="utility:refresh" 
                                                                    onclick={handleAutoRefreshButtonClick}>
                                            </lightning-button-icon>
                                        </template>
                                    </lightning-layout-item>
                                </template>

                                <!-- ------------------------- -->
                                <!-- ADMIN BUTTON              -->
                                <!-- ------------------------- -->
                                <template if:true={allowAdmin}>
                                    <template if:false={listViewData.listView.isNonEditable}>
                                        <lightning-layout-item style="padding-left:5px;">
                                            <lightning-button-icon title={label.List_View_Admin} 
                                                                    size="medium" 
                                                                    icon-name="utility:settings" 
                                                                    onclick={handleAdminButtonClick}>
                                            </lightning-button-icon>
                                        </lightning-layout-item>
                                    </template>
                                </template>
                            </template>
                        </lightning-layout>
                    </lightning-layout-item>
                </lightning-layout>
            </div>
        </template>

        <!-- ---------------------------------------------------------------------------------- -->
        <!-- Section which holds all components for displaying the chosen list view             -->
        <!-- ---------------------------------------------------------------------------------- -->
        <template if:true={isInitialized}>
            <template if:true={listViewData}>

                <!-- --------------------------- -->
                <!-- ROW SELECT COUNT AND EXPORT -->
                <!-- --------------------------- -->
                 <template if:true={virtualText}>
                    <template if:true={displayVirtualText}>
                        <lightning-layout title={virtualText}>
                            <lightning-layout-item size="12" title={virtualText} class="virtualtext">
                                Virtual Data: {virtualText}
                            </lightning-layout-item>
                        </lightning-layout>
                    </template>
                </template>

                <template if:false={isModeSplitView}>
                    
                    <!-- THE ENTIRE TABLE -->
                    <div class={listwrapperstyle}>
                        
                        <!-- ------------------------------------------------------------------------------ -->
                        <!-- Header Row -->
                        <!-- ------------------------------------------------------------------------------ -->
                        <!-- DO NOT PUT CELL STYLE INTO LAYOUT AS IT BREAKS EVERYTHING OUT OF MAIN WINDOW -->
                        <lightning-layout class="table-header" multiple-rows="false">

                            <!-- The SELECT ALL checkbox -->
                            <template if:true={hasListViewDataRows}> 
                                <lightning-layout-item class="header-cell slds-truncate slds-text-align_right" style="min-width: 32px; width: 32px; max-width: 32px">
                                    <lightning-input type="checkbox" 
                                                    variant="label-hidden" 
                                                    value="all" 
                                                    onchange={handleRecordSelectChange}>
                                    </lightning-input>
                                </lightning-layout-item>
                            </template>

                            <!-- The column names -->
                            <template for:each={listViewData.fieldMetaData} for:item="field">
                                <lightning-layout-item 
                                    key={field.name}
                                    class="header-cell slds-truncate"
                                    style={field.columnWidth}
                                    onmouseup={onMouseUpWidth}
                                    onmousemove={onMouseMoveWidth}>
                                    <div class="cell-content">

                                        <template if:true={field.sortable}>
                                            <template if:false={isNoSorting}>
                                                <a class="slds-text-link_reset" value={field.name}>
                                                    <span class="header-label slds-truncate" 
                                                            title={field.sortingTooltip} 
                                                            onclick={sortColumns} 
                                                            data-sortdir={field.sortDir}
                                                            data-name={field.name}
                                                            data-sortindex={field.sortIndex}>{field.label}</span>

                                                    <!-- SORTING -->
                                                    <span if:true={field.sortIndex}>
                                                        <span if:true={field.sortDir}>
                                                            <template if:true={listViewData.isDefaultSort}>
                                                                &nbsp;(&#9660;)
                                                            </template>
                                                            <template if:false={listViewData.isDefaultSort}>
                                                                &nbsp;(&#9660;{field.sortIndexDisplay})
                                                            </template>
                                                        </span>
                                                        <span if:false={field.sortDir}>
                                                            <template if:true={listViewData.isDefaultSort}>
                                                                &nbsp;(&#9650;)
                                                            </template>
                                                            <template if:false={listViewData.isDefaultSort}>
                                                                &nbsp;(&#9650;{field.sortIndexDisplay})
                                                            </template>
                                                        </span>
                                                    </span>
                                                </a>
                                            </template>
                                            <template if:true={isNoSorting}>
                                                <span class="header-label slds-truncate" title={field.label}>{field.label}</span>
                                            </template>
                                        </template>
                                        <template if:false={field.sortable}>
                                            <span class="header-label slds-truncate" title={field.label}>{field.label}</span>
                                        </template>

                                        <!-- The resize handle -->
                                        <div class="resize-handle" onmousedown={onMouseDownWidth} data-index={field.columnIndex}></div>
                                    </div>
                                </lightning-layout-item>
                            </template>

                            <!-- Action Buttons when Editing -->
                            <template if:true={isEdited}>
                                <lightning-layout-item class="header-cell slds-truncate cell-header-edit-buttons">
                                    <div class="cell-center">
                                        <lightning-button-icon title={label.Save_All_Data}
                                                                size="small" 
                                                                icon-name="utility:check" 
                                                                onclick={handleAllRowDataSave}>
                                        </lightning-button-icon>
                                        <lightning-button-icon title={label.Reset_All_Data} 
                                                                size="small" 
                                                                icon-name="utility:recycle_bin_empty" 
                                                                onclick={handleAllRowDataReset}>
                                        </lightning-button-icon>
                                    </div>
                                </lightning-layout-item>
                            </template>

                        </lightning-layout>


                        <!-- ------------------------------------------------------------------------------ -->
                        <!-- Data Rows -->
                        <!-- ------------------------------------------------------------------------------ -->
                        
                        <!-- NO ROWS -->
                        <template if:false={hasListViewDataRows}> 
                            <lightning-layout class="table-row" multiple-rows="false">
                                <lightning-layout-item class="data-cell" size=12>
                                    <div style="text-align:center;">No rows available to be displayed</div>
                                </lightning-layout-item>
                            </lightning-layout>
                        </template>

                        <!-- WE HAVE ROWS -->
                        <template if:true={hasListViewDataRows}>
                            <template for:each={listViewDataRows} for:item="rowData">

                                <!-- Is the row to be displayed? -->
                                <template if:true={rowData.isDisplayed}>

                                    <!-- DO NOT PUT CELL STYLE INTO LAYOUT AS IT BREAKS EVERYTHING OUT OF MAIN WINDOW -->
                                    <lightning-layout key={rowData.rowId} class="table-row" style={rowData.highlightColorCSS} multiple-rows="false">

                                        <!-- The SELECT ROW checkbox -->
                                        <lightning-layout-item class="data-cell slds-truncate slds-text-align_right" style="min-width: 32px; width: 32px; max-width: 32px">
                                            <template if:false={rowData.isTotals}>
                                                <lightning-input type="checkbox" 
                                                                variant="label-hidden" 
                                                                name={rowData.checkBoxId} 
                                                                value={rowData.rowId} 
                                                                onchange={handleRecordSelectChange}>
                                                </lightning-input>
                                            </template>
                                        </lightning-layout-item>                                    

                                        <template for:each={rowData.fields} for:item="fieldData">

                                            <!-- ROW DELETED -->
                                            <template if:true={rowData.isDeleted}>
                                                <td key={fieldData.key} data-label={fieldData.label}>
                                                    <div id={rowData.rowId} class="del-data slds-truncate cell-center" title={fieldData.value}>
                                                        {fieldData.value}
                                                    </div>
                                                </td>
                                            </template>

                                            <!-- ROW NOT DELETED -->
                                            <template if:false={rowData.isDeleted}>

                                                <!-- ROW IS NOT EDITED -->
                                                <template if:false={rowData.isEdited}>

                                                    <lightning-layout-item key={fieldData.key}
                                                                           class="data-cell slds-truncate"
                                                                           style={fieldData.allCssStyle}>

                                                        <div id={rowData.rowId}
                                                                class="cell-content" 
                                                                data-label={fieldData.label}
                                                                ondblclick={setRowEdited}>
                                                                <!-- NO FIELD URL -->
                                                                <template if:true={fieldData.hasURL}>
                                                                <div id={rowData.rowId} 
                                                                    class="slds-truncate"
                                                                    title={fieldData.value}>
                                                                    <a href={fieldData.uRL} onmouseover={displayHoverDetails} 
                                                                                            data-sfdc-id={fieldData.objValueId} 
                                                                                            data-api-name={fieldData.fieldObjName}
                                                                                            data-label-name={fieldData.fieldObjLabel}
                                                                                            target={fieldData.uRLTarget} 
                                                                                            value={rowData.rowId} 
                                                                                            onclick={handleURLClick} 
                                                                                            rel="noreferrer">{fieldData.value}</a>
                                                                </div>
                                                            </template>
                                                            <!-- FIELD HAS URL -->
                                                            <template if:false={fieldData.hasURL}>
                                                                <template if:true={fieldData.isId}>
                                                                    <div id={rowData.rowId} class="slds-truncate" title={fieldData.value}>
                                                                        <a href={fieldData.uRL} target={fieldData.uRLTarget} value={rowData.rowId} onclick={handleURLClick} rel="noreferrer">{fieldData.value}</a>
                                                                    </div>
                                                                </template>
                                                                <template if:true={fieldData.isString}>
                                                                    <div id={rowData.rowId} class="slds-truncate" title={fieldData.value}>
                                                                        {fieldData.value}
                                                                    </div>
                                                                </template>
                                                                <template if:true={fieldData.isRichTextArea}>
                                                                    <div id={rowData.rowId} class="slds-truncate" title={fieldData.value}>
                                                                        <lightning-formatted-rich-text value={fieldData.value}  id={rowData.rowId} data-label={fieldData.label} ondblclick={setRowEdited}></lightning-formatted-rich-text>
                                                                    </div>
                                                                </template>
                                                                    <template if:true={fieldData.isLookup}>
                                                                    <div id={rowData.rowId} class="slds-truncate" title={fieldData.value}>
                                                                        {fieldData.value}
                                                                    </div>
                                                                </template>
                                                                <template if:true={fieldData.isTextArea}>
                                                                    <div id={rowData.rowId} class="slds-truncate" title={fieldData.value}>
                                                                        {fieldData.value}
                                                                    </div>
                                                                </template>
                                                                <template if:true={fieldData.isDate}>
                                                                    <div id={rowData.rowId} class="slds-truncate">
                                                                        <lightning-formatted-date-time value={fieldData.value} year="numeric" month="numeric" day="numeric"></lightning-formatted-date-time>
                                                                    </div>
                                                                </template>
                                                                <template if:true={fieldData.isDateTime}>
                                                                    <div id={rowData.rowId} class="slds-truncate">
                                                                        <lightning-formatted-date-time time-zone={listViewData.userTimeZone} value={fieldData.value} year="numeric" month="numeric" day="numeric" hour="2-digit" minute="2-digit" second="2-digit"></lightning-formatted-date-time>
                                                                    </div>
                                                                </template>
                                                                <template if:true={fieldData.isTime}>
                                                                    <div id={rowData.rowId} class="slds-truncate">
                                                                        <lightning-formatted-date-time value={fieldData.value} hour="2-digit" minute="2-digit" second="2-digit"></lightning-formatted-date-time>
                                                                    </div>
                                                                </template>
                                                                <template if:true={fieldData.isInteger}>
                                                                    <div id={rowData.rowId} class="slds-truncate" title={fieldData.value}>
                                                                        {fieldData.value}
                                                                    </div>
                                                                </template>
                                                                <template if:true={fieldData.isDecimal}>
                                                                    <div id={rowData.rowId} class="slds-truncate" title={fieldData.value}>
                                                                        <lightning-formatted-number value={fieldData.value}></lightning-formatted-number>
                                                                    </div>
                                                                </template>
                                                                <template if:true={fieldData.isBoolean}>
                                                                    <div id={rowData.rowId} class="slds-truncate">
                                                                        <template if:true={fieldData.uIValue}>
                                                                            <lightning-icon size="x-small" icon-name="utility:check" alternative-text="True" title="True"></lightning-icon>
                                                                        </template>
                                                                    </div>
                                                                </template>
                                                                <template if:true={fieldData.isCurrency}>
                                                                    <div id={rowData.rowId} class="slds-truncate" title={fieldData.value}>
                                                                        <lightning-formatted-number value={fieldData.value} format-style="currency" currency-code={fieldData.currencyCode}></lightning-formatted-number>
                                                                    </div>
                                                                </template>
                                                                <template if:true={fieldData.isPhone}>
                                                                    <div id={rowData.rowId} class="slds-truncate" title={fieldData.value}>
                                                                        <lightning-formatted-phone value={fieldData.value}></lightning-formatted-phone>
                                                                    </div>
                                                                </template>
                                                                <template if:true={fieldData.isEmail}>
                                                                    <div id={rowData.rowId} class="slds-truncate" title={fieldData.value}>
                                                                        <lightning-formatted-email value={fieldData.value}></lightning-formatted-email>
                                                                    </div>
                                                                </template>
                                                                <template if:true={fieldData.isDouble}>
                                                                    <div id={rowData.rowId} class="slds-truncate" title={fieldData.value}>
                                                                        <lightning-formatted-number value={fieldData.value}></lightning-formatted-number>
                                                                    </div>
                                                                </template>
                                                                <template if:true={fieldData.isPercent}>
                                                                    <div id={rowData.rowId} class="slds-truncate" title={fieldData.value}>
                                                                        <lightning-formatted-number value={fieldData.value} format-style="percent-fixed" maximum-fraction-digits="2"></lightning-formatted-number>
                                                                    </div>
                                                                </template>
                                                                <template if:true={fieldData.isURL}>
                                                                    <div id={rowData.rowId} class="slds-truncate" title={fieldData.value}>
                                                                        <lightning-formatted-url value={fieldData.value} tooltip="Go to" target="_blank"></lightning-formatted-url>
                                                                    </div>
                                                                </template>
                                                                <template if:true={fieldData.isPicklist}>
                                                                    <div id={rowData.rowId} title={fieldData.value} class="slds-truncate">
                                                                        {fieldData.value}
                                                                    </div>
                                                                </template>
                                                                <template if:true={fieldData.isHTML}>
                                                                    <div id={rowData.rowId} title={fieldData.value} class="slds-truncate" style="text-align:left;">
                                                                        <lightning-formatted-rich-text value={fieldData.value}></lightning-formatted-rich-text>
                                                                    </div>
                                                                </template>
                                                                <template if:true={fieldData.isImage}>
                                                                    <div id={rowData.rowId} title={fieldData.value} class="slds-truncate" style="text-align:center;">
                                                                        <lightning-formatted-rich-text value={fieldData.value}></lightning-formatted-rich-text>
                                                                    </div>
                                                                </template>
                                                                <template if:true={fieldData.isMultiPicklist}>
                                                                    <div id={rowData.rowId} title={fieldData.value} class="slds-truncate" style="text-align:center;">
                                                                        {fieldData.value}
                                                                    </div>
                                                                </template>
                                                            </template>
                                                        </div>
                                                    </lightning-layout-item>
                                                </template>

                                                <!-- ROW IS EDITED -->
                                                <template if:true={rowData.isEdited}>

                                                    <lightning-layout-item key={fieldData.key}
                                                                           class="edited-cell"
                                                                           style={fieldData.allCssStyle}>

                                                        <!-- FIELD IS EDITABLE -->
                                                        <template if:false={fieldData.isEditable}>
                                                            <template if:true={fieldData.isLookup}>
                                                                <div id={rowData.rowId} class="cell-content slds-truncate cell-center" title={fieldData.value}>
                                                                    {fieldData.value}
                                                                </div>
                                                            </template>
                                                            <template if:true={fieldData.isId}>
                                                                <div id={rowData.rowId} class="cell-content slds-truncate cell-center" title={fieldData.value}>
                                                                    <a href={fieldData.uRL} target={fieldData.uRLTarget} value={rowData.rowId} onclick={handleURLClick} rel="noreferrer">{fieldData.value}</a>
                                                                </div>
                                                            </template>
                                                            <template if:true={fieldData.isString}>
                                                                <div id={rowData.rowId} class="cell-content slds-truncate cell-center" title={fieldData.value}>
                                                                    {fieldData.value}
                                                                </div>
                                                            </template>
                                                            <template if:true={fieldData.isRichTextArea}>
                                                                <div id={rowData.rowId} class="cell-content slds-truncate cell-center" title={fieldData.value}>
                                                                    <lightning-formatted-rich-text value={fieldData.value}></lightning-formatted-rich-text>
                                                                </div>
                                                            </template>
                                                            <template if:true={fieldData.isTextArea}>
                                                                <div id={rowData.rowId} class="cell-content slds-truncate cell-center" title={fieldData.value}>
                                                                    {fieldData.value}
                                                                </div>
                                                            </template>
                                                            <template if:true={fieldData.isDate}>
                                                                <div id={rowData.rowId} class="cell-content slds-truncate cell-center">
                                                                    <lightning-formatted-date-time value={fieldData.value} year="numeric" month="numeric" day="numeric"></lightning-formatted-date-time>
                                                                </div>
                                                            </template>
                                                            <template if:true={fieldData.isDateTime}>
                                                                <div id={rowData.rowId} class="cell-content slds-truncate cell-center">
                                                                    <lightning-formatted-date-time time-zone={listViewData.userTimeZone} value={fieldData.value} year="numeric" month="numeric" day="numeric" hour="2-digit" minute="2-digit" second="2-digit"></lightning-formatted-date-time>
                                                                </div>
                                                            </template>
                                                            <template if:true={fieldData.isTime}>
                                                                <div id={rowData.rowId} class="cell-content slds-truncate cell-center">
                                                                    <lightning-formatted-date-time value={fieldData.value} hour="2-digit" minute="2-digit" second="2-digit"></lightning-formatted-date-time>
                                                                </div>
                                                            </template>
                                                            <template if:true={fieldData.isInteger}>
                                                                <div id={rowData.rowId} class="cell-content slds-truncate cell-center" title={fieldData.value}>
                                                                    {fieldData.value}
                                                                </div>
                                                            </template>
                                                            <template if:true={fieldData.isDecimal}>
                                                                <div id={rowData.rowId} class="cell-content slds-truncate cell-center" title={fieldData.value}>
                                                                    <lightning-formatted-number value={fieldData.value}></lightning-formatted-number>
                                                                </div>
                                                            </template>
                                                            <template if:true={fieldData.isBoolean}>
                                                                <div id={rowData.rowId} class="cell-content slds-truncate cell-center">
                                                                    <template if:true={fieldData.uIValue}>
                                                                        <lightning-icon size="x-small" icon-name="utility:check" alternative-text="True" title="True"></lightning-icon>
                                                                    </template>
                                                                </div>
                                                            </template>
                                                            <template if:true={fieldData.isCurrency}>
                                                                <div id={rowData.rowId} class="cell-content slds-truncate cell-center" title={fieldData.value}>
                                                                    <lightning-formatted-number value={fieldData.value} format-style="currency" currency-code={fieldData.currencyCode}></lightning-formatted-number>
                                                                </div>
                                                            </template>
                                                            <template if:true={fieldData.isPhone}>
                                                                <div id={rowData.rowId} class="cell-content slds-truncate cell-center" title={fieldData.value}>
                                                                    <lightning-formatted-phone value={fieldData.value}></lightning-formatted-phone>
                                                                </div>
                                                            </template>
                                                            <template if:true={fieldData.isEmail}>
                                                                <div id={rowData.rowId} class="cell-content slds-truncate cell-center" title={fieldData.value}>
                                                                    <lightning-formatted-email value={fieldData.value}></lightning-formatted-email>
                                                                </div>
                                                            </template>
                                                            <template if:true={fieldData.isDouble}>
                                                                <div id={rowData.rowId} class="cell-content slds-truncate cell-center" title={fieldData.value}>
                                                                    <lightning-formatted-number value={fieldData.value}></lightning-formatted-number>
                                                                </div>
                                                            </template>
                                                            <template if:true={fieldData.isPercent}>
                                                                <div id={rowData.rowId} class="cell-content slds-truncate cell-center" title={fieldData.value}>
                                                                    <lightning-formatted-number value={fieldData.value} format-style="percent-fixed" maximum-fraction-digits="2"></lightning-formatted-number>
                                                                </div>
                                                            </template>
                                                            <template if:true={fieldData.isURL}>
                                                                <div id={rowData.rowId} class="cell-content slds-truncate cell-center" title={fieldData.value}>
                                                                    <lightning-formatted-url value={fieldData.value} tooltip="Go to" target="_blank"></lightning-formatted-url>
                                                                </div>
                                                            </template>
                                                            <template if:true={fieldData.isPicklist}>
                                                                <div id={rowData.rowId} title={fieldData.value} class="cell-content slds-truncate cell-center">
                                                                    {fieldData.value}
                                                                </div>
                                                            </template>
                                                            <template if:true={fieldData.isHTML}>
                                                                <div id={rowData.rowId} title={fieldData.value} class="cell-content slds-truncate cell-center" style="text-align:center;">
                                                                    <lightning-formatted-rich-text value={fieldData.value}></lightning-formatted-rich-text>
                                                                </div>
                                                            </template>
                                                            <template if:true={fieldData.isMultiPicklist}>
                                                                <div class="cell-content slds-truncate cell-center">
                                                                    <div id={rowData.rowId} title={fieldData.value} class="cell-content slds-truncate cell-center" style="text-align:center;">
                                                                        {fieldData.value}
                                                                    </div>
                                                                </div>
                                                            </template>
                                                        </template>

                                                        <!-- FIELD IS EDITABLE -->
                                                        <template if:true={fieldData.isEditable}>
                                                            <template if:true={fieldData.isString}>
                                                                <div id={rowData.rowId} class="slds-truncate cell-center edit-input" title={fieldData.value}>
                                                                    <lightning-input data-type={fieldData.type} data-row-id={rowData.rowId} data-field={fieldData.name} variant=label-hidden type="text" name="input0" value={fieldData.value} onchange={handleFieldDataChange}></lightning-input>
                                                                </div>
                                                            </template>
                                                            <template if:true={fieldData.isRichTextArea}>
                                                                <div id={rowData.rowId} class="slds-truncate cell-center edit-input" title={fieldData.value}>
                                                                    <lightning-input data-type={fieldData.type} data-row-id={rowData.rowId} data-field={fieldData.name} variant=label-hidden type="text" name={fieldData.key} value={fieldData.value} onkeydown={handleQuickDataKeyDown} onclick={handleQuickDataClicked}></lightning-input>
                                                                </div>
                                                            </template>
                                                            <template if:true={fieldData.isTextArea}>
                                                                <div id={rowData.rowId} class="slds-truncate cell-center edit-input" title={fieldData.value}>
                                                                    <lightning-input data-type={fieldData.type} data-row-id={rowData.rowId} data-field={fieldData.name} variant=label-hidden type="text" name={fieldData.key} value={fieldData.value} onkeydown={handleQuickDataKeyDown} onclick={handleQuickDataClicked}></lightning-input>
                                                                </div>
                                                            </template>
                                                            <template if:true={fieldData.isDate}>
                                                                <div id={rowData.rowId} class="slds-truncate edit-input" title={fieldData.value} style="width:98%; padding-right: 4px;">
                                                                    <lightning-input data-type={fieldData.type} data-row-id={rowData.rowId} date-style="short" data-field={fieldData.name} variant=label-hidden type="date" name="input1" value={fieldData.uIValue} onchange={handleFieldDataChange}></lightning-input>
                                                                </div>
                                                            </template>
                                                            <template if:true={fieldData.isDateTime}>
                                                                <div id={rowData.rowId} class="edit-input" title={fieldData.value}>
                                                                    <lightning-input data-type={fieldData.type} data-row-id={rowData.rowId} date-style="short" data-field={fieldData.name} variant=label-hidden type="datetime" name="input2" value={fieldData.uIValue} onchange={handleFieldDataChange}></lightning-input>
                                                                </div>
                                                            </template>
                                                            <template if:true={fieldData.isTime}>
                                                                <div id={rowData.rowId} class="edit-input" title={fieldData.value}>
                                                                    <lightning-input data-type={fieldData.type} data-row-id={rowData.rowId} date-style="short" data-field={fieldData.name} variant=label-hidden type="time" name="input21" value={fieldData.uIValue} onchange={handleFieldDataChange}></lightning-input>
                                                                </div>
                                                            </template>
                                                            <template if:true={fieldData.isInteger}>
                                                                <div id={rowData.rowId} class="slds-truncate cell-center edit-input" title={fieldData.value}>
                                                                    <lightning-input data-type={fieldData.type} data-row-id={rowData.rowId} data-field={fieldData.name} variant=label-hidden type="number" name="input3" value={fieldData.value} onchange={handleFieldDataChange}></lightning-input>
                                                                </div>
                                                            </template>
                                                            <template if:true={fieldData.isDecimal}>
                                                                <div id={rowData.rowId} class="slds-truncate cell-center edit-input" title={fieldData.value}>
                                                                    <lightning-input data-type={fieldData.type} data-row-id={rowData.rowId} data-field={fieldData.name} variant=label-hidden type="number" name="input4" value={fieldData.value} onchange={handleFieldDataChange}></lightning-input>
                                                                </div>
                                                            </template>
                                                            <template if:true={fieldData.isBoolean}>
                                                                <div id={rowData.rowId} class="slds-truncate cell-center edit-input" title={fieldData.value}>
                                                                    <lightning-input data-type={fieldData.type} data-row-id={rowData.rowId} data-field={fieldData.name} variant=label-hidden type="checkbox" name="input5" checked={fieldData.uIValue} onchange={handleFieldDataChange}></lightning-input>
                                                                </div>
                                                            </template>
                                                            <template if:true={fieldData.isCurrency}>
                                                                <div id={rowData.rowId} class="slds-truncate cell-center edit-input" title={fieldData.value}>
                                                                    <lightning-input data-type={fieldData.type} data-row-id={rowData.rowId} data-field={fieldData.name} variant=label-hidden type="number" name="input6" formatter="currency" step="0.01" value={fieldData.value} onchange={handleFieldDataChange}></lightning-input>
                                                                </div>
                                                            </template>
                                                            <template if:true={fieldData.isPhone}>
                                                                <div id={rowData.rowId} class="slds-truncate cell-center edit-input" title={fieldData.value}>
                                                                    <lightning-input data-type={fieldData.type} data-row-id={rowData.rowId} data-field={fieldData.name} variant=label-hidden type="tel" name="input7" value={fieldData.value} onchange={handleFieldDataChange}></lightning-input>
                                                                </div>
                                                            </template>
                                                            <template if:true={fieldData.isEmail}>
                                                                <div id={rowData.rowId} class="slds-truncate cell-center edit-input" title={fieldData.value}>
                                                                    <lightning-input data-type={fieldData.type} data-row-id={rowData.rowId} data-field={fieldData.name} variant=label-hidden type="email" name="input8" value={fieldData.value} onchange={handleFieldDataChange}></lightning-input>
                                                                </div>
                                                            </template>
                                                            <template if:true={fieldData.isDouble}>
                                                                <div id={rowData.rowId} class="slds-truncate cell-center edit-input" title={fieldData.value}>
                                                                    <lightning-input data-type={fieldData.type} data-row-id={rowData.rowId} data-field={fieldData.name} variant=label-hidden type="number" name="input9" value={fieldData.value} onchange={handleFieldDataChange}></lightning-input>
                                                                </div>
                                                            </template>
                                                            <template if:true={fieldData.isPercent}>
                                                                <div id={rowData.rowId} class="slds-truncate cell-center edit-input" title={fieldData.value}>
                                                                    <lightning-input data-type={fieldData.type} data-row-id={rowData.rowId} data-field={fieldData.name} variant=label-hidden type="number" step="0.01" formatter="percent-fixed" name="input10" value={fieldData.value} onchange={handleFieldDataChange}></lightning-input>
                                                                </div>
                                                            </template>
                                                            <template if:true={fieldData.isURL}>
                                                                <div id={rowData.rowId} class="slds-truncate cell-center edit-input" title={fieldData.value}>
                                                                    <lightning-input data-type={fieldData.type} data-row-id={rowData.rowId} data-field={fieldData.name} variant=label-hidden type="url" name="input11" value={fieldData.value} onchange={handleFieldDataChange}></lightning-input>
                                                                </div>
                                                            </template>
                                                            <template if:true={fieldData.isPicklist}>
                                                                <div id={rowData.rowId} title={fieldData.value} class="edit-input" style="overflow: visible !important;">
                                                                    <c-simpli-u-i-list-views-picklist type="picklist"
                                                                                                    row-id={rowData.rowId} 
                                                                                                    sfdc-id={rowData.salesforceId}
                                                                                                    record-type-id={rowData.recordTypeId}
                                                                                                    object-api-name={listViewData.objectName} 
                                                                                                    selected-value={fieldData.value}  
                                                                                                    pick-list-field-api-name={fieldData.name}
                                                                                                    onpicklistchange={handleFieldDataChange}
                                                                                                    variant=label-hidden>
                                                                    </c-simpli-u-i-list-views-picklist>
                                                                </div>
                                                            </template>
                                                            <template if:true={fieldData.isMultiPicklist}>
                                                                <div id={rowData.rowId} class="slds-truncate cell-center edit-input" title={fieldData.value}>
                                                                    <lightning-input data-type={fieldData.type} data-object={listViewData.objectName} data-row-id={rowData.rowId} data-field={fieldData.name} variant=label-hidden type="text" name={fieldData.key} value={fieldData.value} onkeydown={handleQuickDataKeyDown} onclick={handleQuickDataClicked}></lightning-input>
                                                                </div>
                                                            </template>
                                                            <template if:true={fieldData.isLookup}>
                                                                <div id={rowData.rowId} title={fieldData.value} class="edit-input cell-center">
                                                                    <c-simpli-u-i-list-views-lookup field-name={fieldData.name} 
                                                                                                    row-id={rowData.rowId} 
                                                                                                    initial-name={fieldData.value}
                                                                                                    initial-id={fieldData.objValueId}
                                                                                                    field-obj-name={fieldData.fieldObjName}
                                                                                                    onlookupchange={handleFieldDataChange}>
                                                                    </c-simpli-u-i-list-views-lookup>
                                                                </div>
                                                            </template>
                                                        </template>
                                                    </lightning-layout-item>
                                                </template>
                                            </template>
                                        </template>

                                        <!-- -------------------- -->
                                        <!-- ROW ACTION BUTTONS   -->
                                        <!-- -------------------- -->
                                        <template if:true={rowData.isEdited}>
                                            <lightning-layout-item class="edited-cell slds-truncate cell-edit-buttons" 
                                                                   style={rowData.highlightColorCSS}>
                                                <div class="cell-center">
                                                    <lightning-button-icon title={label.Save_Row_Data}
                                                                            value={rowData.rowId}
                                                                            size="small" 
                                                                            icon-name="utility:check" 
                                                                            onclick={handleRowDataSave}>
                                                    </lightning-button-icon>
                                                    <lightning-button-icon title={label.Reset_Row_Data} 
                                                                            value={rowData.rowId}
                                                                            size="small" 
                                                                            icon-name="utility:recycle_bin_empty" 
                                                                            onclick={handleRowDataReset}>
                                                    </lightning-button-icon>
                                                </div>
                                            </lightning-layout-item>
                                        </template>

                                    </lightning-layout>
                                </template>
                            </template>
                        </template>
                    </div>
                </template>
                <template if:true={isModeSplitView}>
                    <div class={listwrapperstyle}>

                        <template if:false={hasListViewDataRows}>
                            <lightning-layout class="table-row" multiple-rows="false">
                                <lightning-layout-item class="data-cell" size=12>
                                    <div style="text-align:center;">No rows available to be displayed</div>
                                </lightning-layout-item>
                            </lightning-layout>
                        </template>

                        <template if:true={hasListViewDataRows}>
                            <template for:each={listViewDataRows} for:item="rowData">
                                <template if:true={rowData.isDisplayed}>
                                    <!-- DO NOT PUT CELL STYLE INTO LAYOUT AS IT BREAKS EVERYTHING OUT OF MAIN WINDOW -->
                                    <lightning-layout multiple-rows key={rowData.rowId} data-row-id={rowData.salesforceId} style={rowData.highlightColorCSS} onclick={handleSplitViewClick}>
                                        <lightning-layout-item size=6 class="split-data-cell-top slds-truncate">{rowData.splitColumnOne}</lightning-layout-item>
                                        <lightning-layout-item size=6 class="split-data-cell-top slds-truncate">{rowData.splitColumnTwo}</lightning-layout-item>
                                        <lightning-layout-item size=6 class="split-data-cell-bottom slds-truncate">{rowData.splitColumnThree}</lightning-layout-item>
                                        <lightning-layout-item size=6 class="split-data-cell-bottom slds-truncate">{rowData.splitColumnFour}</lightning-layout-item>
                                    </lightning-layout>

                                </template>
                            </template>
                        </template>
                    </div>
                </template>
            </template>
        </template>
    </div>

    <!-- ---------------------------------------------------------------------------------- -->
    <!-- The POPUP view if the mouse moves over a field which has hover information                                -->
    <!-- ---------------------------------------------------------------------------------- -->
    <c-simpli-u-i-list-views-hover-detail is-displayed={hoverIsDisplayed}
                                            record-id={hoverSFDCId}
                                            record-api-name={hoverAPIName}
                                            record-label-name={hoverLabelName}
                                            position-left={hoverPositionLeft}
                                            position-top={hoverPositionTop}
                                            onerror={processHoverError}
                                            onhide={processHoverHide}>
    </c-simpli-u-i-list-views-hover-detail>

    <!-- ---------------------------------------------------------------------------------- -->
    <!-- The modal view if a SCREENS FLOW action is selected                                -->
    <!-- ---------------------------------------------------------------------------------- -->
    <template if:true={showFlowModal}>
        <c-simpli-u-i-list-views-flow-frame show-modal={showFlowModal}
                                            record-ids={selectedRecordIds}
                                            list-view-object-a-p-i-name={selectedObject}
                                            list-view-a-p-i-name={selectedListView}
                                            action-parameters={selectedActionParameters}
                                            action-api-name={selectedActionKey}
                                            onprocessed={processFlowModal}
                                            oncancelled={cancelFlowModal}
                                            onfinished={finishFlowModal}>
        </c-simpli-u-i-list-views-flow-frame>
    </template>
    <!-- ---------------------------------------------------------------------------------- -->
    <!-- The modal view if the ACTION button is pressed and we need to display something    -->
    <!-- ---------------------------------------------------------------------------------- -->
    <c-simpli-u-i-list-views-action-modal show-modal={showActionModal}
                                            action-api-name={selectedActionKey}
                                            record-ids={selectedRecordIdsStr}
                                            onprocessed={processActionModal}
                                            oncancelled={cancelActionModal}
                                            onrunaction={processActionModalRunAction}
                                            virtual={virtual}>
    </c-simpli-u-i-list-views-action-modal>

    <!-- ---------------------------------------------------------------------------------- -->
    <!-- The modal view if the ADMIN button is pressed and we need to display something     -->
    <!-- ---------------------------------------------------------------------------------- -->
    <c-simpli-u-i-list-views-admin-modal show-modal={showAdminModal}
                                            list-view-object={selectedObject}
                                            list-view-name={selectedListView}
                                            onclose={processAdminModal}
                                            list-view-mode={mode}>
    </c-simpli-u-i-list-views-admin-modal>

    <!-- ---------------------------------------------------------------------------------- -->
    <!-- The modal view if the MASS CREATE action is selected                               -->
    <!-- ---------------------------------------------------------------------------------- -->
    <c-simpli-u-i-list-views-mass-create-modal show-modal={showMassCreateModal}
                                                object-name={selectedObject}
                                                list-view-name={massCreateListView}
                                                master-obj-id={relatedRecordId}
                                                master-obj-field={joinFieldName}
                                                onclose={handleMassCreateModalClose}>
    </c-simpli-u-i-list-views-mass-create-modal>

    <!-- ---------------------------------------------------------------------------------- -->
    <!-- The modal view if the EMAIL TEMPLATE action is selected                            -->
    <!-- ---------------------------------------------------------------------------------- -->
    <c-simpli-u-i-list-views-email-template-modal show-modal={showEmailTemplateModal}
                                                  folder-name={emailTemplateFolder}
                                                  record-ids={selectedRecordIds}
                                                  what-id-field={emailTemplateWhatIdField}
                                                  onclose={handleEmailTemplateModalClose}>
    </c-simpli-u-i-list-views-email-template-modal>

    <!-- ---------------------------------------------------------------------------------- -->
    <!-- The modal view when a rich-text-field is edited                                    -->
    <!-- ---------------------------------------------------------------------------------- -->
    <c-simpli-u-i-list-views-quick-data-modal show-modal={showQuickDataModal}
                                                heading={quickDataHeading}
                                                field-type={quickDataFieldType}
                                                field-name={quickDataFieldName}
                                                object-name={quickDataObjectName}
                                                field-label={quickDataFieldLabel}
                                                field-data-id={quickDataRowId}
                                                field-value={quickDataFieldValue}
                                                oncancel={handleQuickDataCancelled}
                                                onok={handleQuickDataChange}>
    </c-simpli-u-i-list-views-quick-data-modal>

</template>